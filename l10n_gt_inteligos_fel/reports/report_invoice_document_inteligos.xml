<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record model="ir.ui.view" id="report_invoice_document_inteligos_fel">
        <field name="name">Herencia de vista Facturas FEL de Guatemala</field>
        <field name="inherit_id" ref="account.report_invoice_document"/>
        <field name="arch" type="xml">
            <xpath expr="//t[@t-name='account.report_invoice_document']" position="replace">
                <t t-name="account.report_invoice_document">
                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <div class="article o_report_layout_standard" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">

                        <div class="page" style="font-size:11px;">

                            <div style="text-align:center;" class="row mt32 bt32">
                                <t t-if="o.journal_id.sequence_id.l10n_latam_document_type_id.doc_code_prefix" t-set="doc_type" t-value="o.journal_id.sequence_id.l10n_latam_document_type_id.doc_code_prefix.strip()"/>
                              <div class="col-7 text-center" style="text-align: center; vertical-align: center;">
                                    <table class="table-borderless">
                                        <tr>
                                            <td style="text-align:left;width:200px;vertical-align:middle;">
                                                <img t-if="o.company_id.logo" style="max-width:200px;margin:auto;" t-att-src="image_data_uri(o.company_id.logo)" alt="Logo"/>
                                            </td>
                                            <t t-if="o.pos_inv == True">
                                                <t t-set="pos" t-value="o.pos_order_ids[0]"/>
                                                <td class="text-center" name="pos_address" style="text-align: left; padding-left:30px;font-size:9px;width:300px;border:1px solid white;">
                                                    <div>
                                                        <strong style="font-size:11px;" t-field="pos.config_id.name"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="o.company_id.legal_name"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="pos.config_id.street"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="pos.config_id.county_id.name"/>
                                                    </div>
                                                    <div><span t-field="pos.config_id.state_id.name"/>,
                                                        <span t-field="pos.config_id.country_id.name"/>
                                                    </div>
                                                    <div>Nit
                                                        <span t-field="o.company_id.vat"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="o.company_id.email"/>
                                                    </div>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td class="text-center" name="company_address" style="text-align: left; padding-left:30px;font-size:9px;width:300px;">
                                                    <div>
                                                        <strong style="font-size:11px;" t-field="o.company_id.legal_name"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="o.company_id.street"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="o.company_id.street2"/>
                                                    </div>
                                                    <div><span t-field="o.company_id.state_id.name"/>,
                                                        <span t-field="o.company_id.country_id.name"/>
                                                    </div>
                                                    <div>NIT
                                                        <span t-field="o.company_id.vat"/>
                                                    </div>
                                                    <div>
                                                        <span t-field="o.company_id.email"/>
                                                    </div>
                                                </td>
                                            </t>
                                        </tr>
                                    </table>
                                </div>
                              <div class="col-5">
                                  <div style="padding-right:15px;">
                                      <div t-if="o.fel_uuid" class="row" style="text-align:center;">
                                          <div class="col-12">
                                              <span style="font-size:8px;">Documento Tributario Electrónico</span>
                                          </div>
                                      </div>
                                      <div class="row mt0 bt0 border-top">
                                          <div class="col-12">
                                              <span style="font-size:18px;font-weight:bold;" t-field="o.invoice_doc_type.name"/>
                                          </div>
                                      </div>
                                      <div class="row border">
                                          <div class="col-4 invheader">
                                              <span>Serie</span>
                                          </div>
                                          <div class="col-4 invheader">
                                              <span>Número</span>
                                          </div>
                                          <div class="col-4 invheader">
                                              <span>Fecha</span>
                                          </div>
                                      </div>
                                      <div class="row border-bottom">
                                          <div class="col-4">
                                              <span t-field="o.fel_serie"/>
                                          </div>
                                          <div class="col-4">
                                              <span t-field="o.fel_number"/>
                                          </div>
                                          <div class="col-4">
                                              <span t-field="o.invoice_date"/>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                            </div>

                            <t t-if="1==0">
                                <address style="display:none !important;"/>
                            </t>

                            <div id="customer_info" class="mt-1 mb16" style="border-top:2px solid gray;">
                                <div class="row mt-1 mb-1">
                                    <div class="col-9">
                                        <strong>Nombre:</strong>
                                        <t t-if="o.partner_id.legal_name">
                                            <span class="m-0" t-field="o.partner_id.legal_name"/>
                                        </t>
                                        <t t-elif="o.partner_id.name">
                                            <span class="m-0" t-field="o.partner_id.name"/>
                                        </t>
                                    </div>
                                    <div class="col-3">
                                        <strong>NIT:</strong>
                                        <span class="m-0" t-field="o.partner_id.vat"/>
                                    </div>
                                </div>
                                <div class="row ">
                                    <div class="col-12">
                                        <strong>Direccion:</strong>
                                        <span class="m-0" t-field="o.partner_id.street"/>
                                    </div>
                                </div>
                            </div>

                            <div t-if="o.company_id.show_head_info_report_invoice" id="informations">
                                <div class="row">
                                    <div class="col-auto mw-100 mb-2" t-if="o.name and o.move_type == 'out_invoice' and o.state == 'posted'" name="doc_number">
                                        <strong>Correlativo:</strong>
                                        <p class="m-0" t-field="o.name"/>
                                    </div>
                                    <div class="col-auto mw-100 mb-2" t-if="o.invoice_payment_term_id and o.move_type == 'out_invoice' and o.state == 'posted'" name="payment_term">
                                        <strong>Forma de Pago:</strong>
                                        <p class="m-0" t-field="o.invoice_payment_term_id.note"/>
                                    </div>
                                    <div class="col-auto mw-100 mb-2" t-if="o.invoice_origin" name="origin">
                                        <strong>Cotización:</strong>
                                        <p class="m-0" t-field="o.invoice_origin"/>
                                    </div>
                                    <div class="col-auto mw-100 mb-2" t-if="o.partner_id.ref" name="customer_code">
                                        <strong>Código Cliente:</strong>
                                        <p class="m-0" t-field="o.partner_id.ref"/>
                                    </div>
                                    <div class="col-auto mw-100 mb-2" t-if="o.ref" name="partner_ref">
                                        <strong>Referencia Cliente:</strong>
                                        <p class="m-0" t-field="o.ref"/>
                                    </div>
                                    <div class="col-auto mw-100 mb-2" t-if="o.invoice_user_id" name="reference">
                                        <strong>Vendedor:</strong>
                                        <p class="m-0" t-field="o.invoice_user_id"/>
                                    </div>
                                </div>
                            </div>


                            <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                            <div style="height:550px;">
                                <table class="table table-sm o_main_table" name="invoice_line_table">
                                    <thead>
                                        <tr>
                                            <t t-set="colspan" t-value="6"/>
                                            <th name="th_description" class="text-start" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Descripción</span>
                                                </div>
                                            </th>

                                            <th name="th_source" class="d-none text-start" t-if="0" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Doc. Origen</span>
                                                </div>
                                            </th>
                                            <th name="th_type" class="text-center" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Tipo</span>
                                                </div>
                                            </th>
                                            <th name="th_quantity" class="text-right" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Cantidad</span>
                                                </div>
                                            </th>
                                            <th name="th_priceunit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Precio Unitario</span>
                                                </div>
                                            </th>

                                            <th t-if="display_discount" name="th_price_unit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Desc.%</span>
                                                    <!-- TODO: remove in master -->
                                                    <t t-set="colspan" t-value="colspan+1"/>
                                                </div>
                                            </th>
                                            <th name="th_tax" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span>Impuestos</span>
                                                </div>
                                            </th>
                                            <th name="th_subtotal" class="text-right" style="vertical-align: middle; text-align: center;">
                                                <div>
                                                    <span groups="account.group_show_line_subtotals_tax_excluded">Total
                                                    </span>
                                                    <span groups="account.group_show_line_subtotals_tax_included">Precio Total
                                                    </span>
                                                </div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="invoice_tbody">
                                        <t t-set="current_subtotal" t-value="0"/>
                                        <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>

                                        <t t-foreach="lines" t-as="line">
                                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                                            <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                                <t t-if="line.display_type == 'product'" name="account_invoice_line_accountable">
                                                    <td name="account_invoice_line_name">
                                                        <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <t t-set="type" t-value="'S' if line.product_id.detailed_type == 'service' else 'B'"/>
                                                        <span t-esc="type"/>
                                                    </td>
                                                    <td class="text-end">
                                                        <span t-field="line.quantity"/>
                                                        <span t-field="line.product_uom_id" groups="uom.group_uom"/>
                                                    </td>
                                                    <td t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                                        <span class="text-nowrap" t-field="line.price_unit"/>
                                                    </td>
                                                    <td t-if="display_discount" t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                                        <span class="text-nowrap" t-field="line.discount"/>
                                                    </td>
                                                    <td t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                                        <span t-esc="'%.2f'%(float(line.price_total)-float(line.price_subtotal))"/>
                                                    </td>
                                                    <td class="text-end o_price_total">
                                                        <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_excluded"/>
                                                        <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                                    </td>
                                                </t>
                                                <t t-if="line.display_type == 'line_note'">
                                                    <td colspan="99">
                                                        <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                                    </td>
                                                </t>
                                            </tr>

                                        </t>
                                    </tbody>

                                    <t t-if="o.state == 'cancel'">
                                        <div style="border-radius: 10px;-webkit-transform: rotate(-30deg);position:absolute;left:8cm;top:16cm;color:red;background-color:white;border:2px red solid;padding:10px;text-align:center;width:200px;">
                                            <div style="font-size:30px;font-weight:bold;">ANULADO</div>
                                            <!--<div style="font-size:12px;">Motivo:</div>-->
                                        </div>
                                    </t>

                                    <p t-if="o.narration" name="comment">
                                        <span t-field="o.narration"/>
                                    </p>

                                    <t t-set="phrases" t-value="o.company_id.fel_phrases_ids.sorted(key=lambda l: (l.name), reverse=True)"/>
                                    <div class="mt-2 mb-2">
                                        <t t-foreach="phrases" t-as="phrase">
                                            <div>
                                                <span t-field="phrase.name"/>
                                            </div>
                                        </t>
                                    </div>

                                    <div class="mt32 mb32 border-top border-bottom">
                                        <table id="total" style="width:100%;" class="table-borderless">
                                            <tr>
                                                <td width="70%">
                                                    <strong>Total en Letras:</strong>
                                                    <p class="m-0" t-field="o.amount_in_words"/>
                                                </td>
                                                <td width="10%" style="background:lightgray;vertical-align:middle;text-align:center;">
                                                    <strong>TOTAL:</strong>
                                                </td>
                                                <td width="20%" style="vertical-align:middle;text-align:right;">
                                                    <div id="total">
                                                        <span class="text-nowrap" t-field="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>

                                </table>
                            </div>
                        </div>

                        <div t-attf-class="footer o_standard_footer">
                            <div class="text-left" style="font-size:10px;">
                                <div class="text-center mt-1" style="border-radius: 10px; border: 1px solid black">
                                    <div style="margin-top: 1px; margin-bottom: 1px; backgroun: skyblue;">
                                        <strong>DATOS DEL CERTIFICADOR</strong>
                                    </div>
                                </div>
                                <div class="row mt-1">
                                    <div class="col-6">
                                        <div>
                                            <strong>No. Autorizacion:
                                                <span t-field="o.fel_uuid"/>
                                            </strong>
                                        </div>
                                        <div>
                                            <strong>Fecha Certificacion:
                                                <span t-field="o.fel_date"/>
                                            </strong>
                                        </div>
                                        <div>
                                            <strong>Certificador:
                                                <span t-field="o.company_id.fel_provider"/>
                                                <span>NIT:</span>
                                                <span t-field="o.company_id.nit_fel_provider"/>
                                            </strong>
                                        </div>
                                        <div t-if="report_type == 'pdf'" class="text-muted text-end">
                                            Page:
                                            <span class="page"/>
                                            /
                                            <span class="topage"/>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                    </div>
                                    <div class="col-4 text-end">
                                        <t t-if="o.fel_uuid and o.company_id.fel_provider == 'IN'">
                                            <img t-att-src="'/report/barcode/?barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s'%('QR', 'https://report.feel.com.gt/ingfacereport/ingfacereport_documento?uuid='+o.fel_uuid, 80, 80)"/>
                                        </t>
                                        <t t-if="o.fel_uuid and o.company_id.fel_provider == 'DI'">
                                            <img t-att-src="'/report/barcode/?barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s'%('QR', 'https://felgtaws.digifact.com.gt/guest/api/FEL?DATA='+o.company_id.vat+'|'+o.fel_uuid+'|'+'GUESTUSERQR', 80, 80)"/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <style>
                        .invheader{background-color: lightgray;}
                    </style>
                </t>
            </xpath>
        </field>
    </record>

    <record id="paper_format_invoice_inteligos" model="report.paperformat">
        <field name="name">Paper Invoice</field>
        <field name="default" eval="True"/>
        <field name="format">Letter</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">5</field>
        <field name="margin_bottom">35</field>
        <field name="margin_left">5</field>
        <field name="margin_right">5</field>
        <field name="header_spacing">5</field>
        <field name="disable_shrinking" eval="True"/>
        <field name="dpi">90</field>
    </record>

    <record id="account.account_invoices" model="ir.actions.report">
        <field name="paperformat_id" ref="l10n_gt_inteligos_fel.paper_format_invoice_inteligos"/>
    </record>
</odoo>